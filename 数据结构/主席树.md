### 主席树
```cpp
struct node
{
	int cnt, ls, rs;
};

int n,q,idx,mx;
vector<int> a(N), dis, root(N);
vector<node> t(N<<5);
int get(int x)
{
	return (lower_bound(dis.begin(),dis.end(),x) - dis.begin()+1);
}

void insert(int &p,int pre,int val,int be=1,int ed=mx)
{
	 p = ++ idx;
	 t[p] = t[pre];
	 t[p].cnt ++;
	 if(be == ed)	return ;
	 int mid = (be+ed) >> 1;
	 if(val <= mid)	insert(t[p].ls,t[pre].ls,val,be,mid);
	 else	insert(t[p].rs,t[pre].rs,val,mid+1,ed);
}

int query(int lo,int ro,int k,int be=1,int ed=mx) 
{
	if(be == ed)	return be;
	int mid = (be + ed) >> 1, lcnt = t[t[ro].ls].cnt - t[t[lo].ls].cnt;
	if(k <= lcnt)	return query(t[lo].ls,t[ro].ls,k,be,mid);
	else	return query(t[lo].rs,t[ro].rs,k-lcnt,mid+1,ed);
	
}

void func(void)
{
	cin >> n >> q;
	for(int i=1;i<=n;++i)	cin >> a[i];
	for(int i=1;i<=n;++i)	dis.push_back(a[i]);
	sort(dis.begin(),dis.end());
	dis.erase(unique(dis.begin(),dis.end()),dis.end());
	mx = dis.size();
	for(int i=1;i<=n;++i)	insert(root[i],root[i-1],get(a[i]));
	while(q--)
	{
		int l,r,k;
		cin >> l >> r >> k;
		cout << dis[query(root[l-1],root[r],k)-1] << '\n';
	}
}
```