## 前缀和
### 多维前缀和
本质为容斥
**二维**
```cpp
s[i][j] = a[i][j] + s[i][j-1] + s[i-1][j] - s[i-1][j-1];
```

**三维**
```cpp
s[i][j][k] = a[i][j][k];
        + s[i-1][j][k] + s[i][j-1][k] + s[i][j][k-1];
        - s[i-1][j-1][k] - s[i][j-1][k-1] - s[i-1][j][k-1];
        + s[i-1][j-1][k-1];
```

### 前缀和的变形
广义的"前缀和"运算, 是指连续的进行若干次操作, 产生一个叠加影响, 如果这种影响可以通过某种反向操作"撤销. 

### 运用
#### 维护可叠加操作
[牛牛的猜球游戏](https://ac.nowcoder.com/acm/contest/19483/F)
初始状态：杯子中球的编号从左到右为 $0,1,2,\ldots,9$。  
有 $n$ 次操作，每次操作交换第 $a$ 个杯子和第 $b$ 个杯子（下标从 $0$ 开始）。  
进行 $m$ 轮游戏，每轮给定 $l, r$，从第 $l$ 次操作执行到第 $r$ 次操作（操作编号从 $1$ 开始）。  
求每轮游戏结束后，从左到右的杯子中球的编号序列。

- 已知$A \rightarrow B$和$A \rightarrow C$, 求$B \rightarrow C$. 
- 可以用$B \rightarrow A$与$A \rightarrow C$叠加, 但要注意顺序. 

```cpp
void func(void)
{
	int n,m;
	cin >> n >> m;
	vector<vector<int>> a(n+1,vector<int>(10,0));
	for(int i=0;i<10;++i)	a[0][i] = i;
	for(int i=1;i<=n;++i)
	{
		a[i] = a[i-1];
		int l,r;
		cin >> l >> r;
		swap(a[i][l],a[i][r]);
	}
	vector<int> temp(10);
	while(m--)
	{
		int l,r;
		cin >> l >> r;
		for(int i=0;i<10;++i)	temp[a[l-1][i]] = i;
		for(int i=0;i<10;++i)	cout << temp[a[r][i]] << ' ';
		cout << '\n';
	}
}
```

## 差分
公式: $d_i = a_i - a_{i-1}$ 
**给一个区间加上等差数列**, 等同于对二重差分进行差分操作. 
**给一个区间加上平方**, 平方数的差分为连续奇数, 那么对二维差分区间修改, 也就是对三位差分进行区间操作即可. 
### 例题
**I**: 区间加 $1$，问多少次能变成原数组
一次区间+1, 等同一次差分, 也就是$d_i+1$, $d_{j+1} - 1$, 那么差分数组的和最后必为$0$. 
*注*: 对于$1 \sim n$ 均 $+1$, 可以理解为$d_1 + 1, d_{n+1}-1$. 
**H**: 三种操作分别对应三个维度的差分, 可以把三种差分分开操作, 最后合并, 更方便理解.
    只用一个数组维护三种差分会麻烦很多. 就想树状数组维护区间修改一样.